!function(e){"use strict";var t={apiUrl:"/api/media-list",perPage:48,title:"Media Library",selectText:"Select",cancelText:"Cancel",allText:"All",searchPlaceholder:"Search files...",emptyText:"No files found",errorText:"Error loading files",fileInfoText:"{count} files",selectedInfoText:"{selected} selected â€” {count} files",uploaderButtonText:"Media Library",uploaderButtonIcon:"bi bi-images",ajaxHeaders:{},ajaxData:{}},i=!1;var a=null,l={files:[],folders:[],selected:[],folder:"",search:"",page:1,pages:1,total:0,multiple:!1,loading:!1,onSelect:null,config:{}},n=null,r={pdf:"bi-file-earmark-pdf text-danger",doc:"bi-file-earmark-word text-primary",docx:"bi-file-earmark-word text-primary",xls:"bi-file-earmark-excel text-success",xlsx:"bi-file-earmark-excel text-success",csv:"bi-file-earmark-spreadsheet text-success",ppt:"bi-file-earmark-ppt text-warning",pptx:"bi-file-earmark-ppt text-warning",txt:"bi-file-earmark-text text-secondary",zip:"bi-file-earmark-zip text-info",rar:"bi-file-earmark-zip text-info",mp4:"bi-file-earmark-play text-info",mp3:"bi-file-earmark-music text-info",svg:"bi-filetype-svg text-warning"};function o(e){var t=(e||"").split(".").pop().toLowerCase();return r[t]||"bi-file-earmark text-secondary"}function d(e){return e<1024?e+" B":e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}function s(t){return e("<span>").text(t).html()}function c(e,t){return e.replace(/\{(\w+)\}/g,function(e,i){return void 0!==t[i]?t[i]:e})}function m(){if(!a){!function(){if(!i){i=!0;var t=[".ml-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}","@media(max-width:1200px){.ml-grid{grid-template-columns:repeat(4,1fr)}}","@media(max-width:992px){.ml-grid{grid-template-columns:repeat(3,1fr)}}","@media(max-width:576px){.ml-grid{grid-template-columns:repeat(2,1fr)}}",".ml-item{position:relative;border:2px solid #dee2e6;border-radius:6px;cursor:pointer;overflow:hidden;transition:border-color .15s,box-shadow .15s;background:#f8f9fa}",".ml-item:hover{border-color:#6c757d}",".ml-item.selected{border-color:#0d6efd;box-shadow:0 0 0 2px rgba(13,110,253,.35)}",".ml-item-img{width:100%;height:100px;object-fit:cover;display:block}",".ml-item-icon{width:100%;height:100px;display:flex;align-items:center;justify-content:center;font-size:2.5rem;color:#6c757d}",".ml-item-name{font-size:11px;padding:4px 6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center;color:#495057}",".ml-item .ml-check{position:absolute;top:4px;right:4px;width:22px;height:22px;border-radius:50%;background:#0d6efd;color:#fff;display:none;align-items:center;justify-content:center;font-size:12px}",".ml-item.selected .ml-check{display:flex}",".ml-folders .btn{font-size:12px;padding:2px 10px}",".ml-folders .btn.active{background:#0d6efd;color:#fff;border-color:#0d6efd}",".ml-footer-info{font-size:13px;color:#6c757d}",".ml-search{max-width:220px}",".ml-pagination .page-link{font-size:13px;padding:4px 10px}",".ml-empty{text-align:center;padding:60px 20px;color:#adb5bd}",".ml-empty i{font-size:3rem;display:block;margin-bottom:10px}",".ml-loading{text-align:center;padding:60px 20px;color:#adb5bd}",".ml-loading i{font-size:2rem;animation:ml-spin 1s linear infinite}","@keyframes ml-spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}",".ml-browse-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;color:#6c757d;font-size:11px;width:100%;height:100%}",".ml-browse-btn i{font-size:1.3rem;margin-bottom:2px}",".ml-browse-btn:hover{color:#0d6efd}"].join("\n");e('<style id="media-library-css">').text(t).appendTo("head")}}();var t=l.config,n=['<div class="modal fade" id="mediaLibraryModal" tabindex="-1">','<div class="modal-dialog modal-xl modal-dialog-scrollable">','<div class="modal-content">','<div class="modal-header py-2">','<h6 class="modal-title"><i class="bi bi-images me-1"></i>'+s(t.title)+"</h6>",'<button type="button" class="btn-close" data-bs-dismiss="modal"></button>',"</div>",'<div class="px-3 pt-2 pb-1 border-bottom">','<div class="d-flex flex-wrap align-items-center gap-2">','<div class="ml-folders btn-group flex-wrap" id="mlFolders"></div>','<div class="ms-auto">','<input type="text" class="form-control form-control-sm ml-search" id="mlSearch" placeholder="'+s(t.searchPlaceholder)+'">',"</div>","</div>","</div>",'<div class="modal-body" style="min-height:340px;">','<div class="ml-grid" id="mlGrid"></div>','<div class="ml-empty" id="mlEmpty" style="display:none;"><i class="bi bi-folder2-open"></i>'+s(t.emptyText)+"</div>",'<div class="ml-loading" id="mlLoading" style="display:none;"><i class="bi bi-arrow-repeat"></i></div>',"</div>",'<div class="modal-footer py-2 d-flex justify-content-between">','<div class="ml-footer-info" id="mlInfo"></div>','<div class="d-flex align-items-center gap-2">','<nav><ul class="pagination pagination-sm mb-0 ml-pagination" id="mlPagination"></ul></nav>','<button type="button" class="btn btn-sm btn-secondary" data-bs-dismiss="modal">'+s(t.cancelText)+"</button>",'<button type="button" class="btn btn-sm btn-primary" id="mlSelectBtn" disabled>'+s(t.selectText)+"</button>","</div>","</div>","</div></div></div>"].join("");a=e(n),e("body").append(a),a.on("click","#mlSelectBtn",v),a.on("click",".ml-item",u),a.on("click",".ml-folder-btn",g),a.on("click",".ml-page-btn",x),a.on("input","#mlSearch",b),a.on("hidden.bs.modal",function(){l.selected=[],l.onSelect=null})}}function p(){var e=l.config,t=l.selected.length,i=t>0?c(e.selectedInfoText,{selected:t,count:l.total}):c(e.fileInfoText,{count:l.total});a.find("#mlInfo").html(i),a.find("#mlSelectBtn").prop("disabled",0===t)}function f(){if(!l.loading){l.loading=!0;a.find("#mlGrid").hide(),a.find("#mlEmpty").hide();a.find("#mlLoading").show();var t=l.config,i=e.extend({},t.ajaxData,{folder:l.folder,search:l.search,page:l.page});e.ajax({url:t.apiUrl,data:i,dataType:"json",headers:t.ajaxHeaders,success:function(e){l.files=e.files||[],l.folders=e.folders||[],l.total=e.total||0,l.page=e.page||1,l.pages=e.pages||1,function(){var e=l.config,t=a.find("#mlFolders").empty();t.append('<button type="button" class="btn btn-outline-secondary btn-sm ml-folder-btn'+(""===l.folder?" active":"")+'" data-folder="">'+s(e.allText)+"</button>");for(var i=0;i<l.folders.length;i++){var n=l.folders[i],r=l.folder===n?" active":"";t.append('<button type="button" class="btn btn-outline-secondary btn-sm ml-folder-btn'+r+'" data-folder="'+s(n)+'">'+s(n)+"</button>")}}(),function(){var e=a.find("#mlGrid").empty(),t=a.find("#mlEmpty");if(a.find("#mlLoading").hide(),0===l.files.length)return e.hide(),void t.show();t.hide(),e.show();for(var i=0;i<l.files.length;i++){var n,r=l.files[i],c=l.selected.some(function(e){return e.url===r.url})?" selected":"";n="image"===r.type?'<img class="ml-item-img" loading="lazy" src="'+r.url+'" alt="'+s(r.name)+'">':'<div class="ml-item-icon"><i class="bi '+o(r.name)+'"></i></div>',e.append('<div class="ml-item'+c+'" data-url="'+r.url+'" data-name="'+s(r.name)+'" title="'+s(r.name)+" ("+d(r.size)+')">'+n+'<div class="ml-check"><i class="bi bi-check"></i></div><div class="ml-item-name">'+s(r.name)+"</div></div>")}}(),function(){var e=a.find("#mlPagination").empty();if(!(l.pages<=1)){e.append('<li class="page-item'+(l.page<=1?" disabled":"")+'"><a class="page-link ml-page-btn" data-page="'+(l.page-1)+'" href="#">&laquo;</a></li>');var t=Math.max(1,l.page-3),i=Math.min(l.pages,t+6);i-t<6&&(t=Math.max(1,i-6));for(var n=t;n<=i;n++)e.append('<li class="page-item'+(n===l.page?" active":"")+'"><a class="page-link ml-page-btn" data-page="'+n+'" href="#">'+n+"</a></li>");e.append('<li class="page-item'+(l.page>=l.pages?" disabled":"")+'"><a class="page-link ml-page-btn" data-page="'+(l.page+1)+'" href="#">&raquo;</a></li>')}}(),p()},error:function(){a.find("#mlGrid").empty().hide(),a.find("#mlLoading").hide(),a.find("#mlEmpty").show().html('<i class="bi bi-exclamation-triangle"></i>'+s(t.errorText))},complete:function(){l.loading=!1,a.find("#mlLoading").hide()}})}}function u(t){var i=e(t.currentTarget),n=i.data("url"),r=i.data("name");if(l.multiple){for(var o=-1,d=0;d<l.selected.length;d++)if(l.selected[d].url===n){o=d;break}o>=0?(l.selected.splice(o,1),i.removeClass("selected")):(l.selected.push({url:n,name:r}),i.addClass("selected"))}else l.selected=[{url:n,name:r}],a.find(".ml-item").removeClass("selected"),i.addClass("selected");p()}function g(t){t.preventDefault(),l.folder=e(t.currentTarget).data("folder"),l.page=1,f()}function b(){clearTimeout(n),n=setTimeout(function(){l.search=a.find("#mlSearch").val().trim(),l.page=1,f()},300)}function x(t){t.preventDefault();var i=parseInt(e(t.currentTarget).data("page"),10);i<1||i>l.pages||i===l.page||(l.page=i,f())}function v(){if(0!==l.selected.length){var e=l.onSelect,t=l.selected.slice();bootstrap.Modal.getInstance(a[0]).hide(),"function"==typeof e&&e(t)}}var h={open:function(i){i=i||{},l.config=e.extend({},t,h.defaults,i),m(),l.multiple=!!i.multiple,l.folder=i.folder||"",l.search="",l.page=1,l.selected=[],l.onSelect=i.onSelect||null,a.find("#mlSearch").val(""),bootstrap.Modal.getOrCreateInstance(a[0]).show(),f()},defaults:e.extend({},t),version:"1.0.0"};function y(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&parseInt(e[19],16)|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function w(e){var t=(e||"").split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","webp","svg","ico","bmp"].indexOf(t)>=0?"image":"other"}function k(i){var a=i.$uploaderContainer;if(a&&!a.find(".ml-browse-card").length){var l=i.options.multiple,n=e.extend({},t,h.defaults),r=e('<div class="jquery-uploader-select-card ml-browse-card"><div class="jquery-uploader-select"><div class="ml-browse-btn"><i class="'+s(n.uploaderButtonIcon)+'"></i><span>'+s(n.uploaderButtonText)+"</span></div></div></div>");r.on("click",function(){h.open({multiple:l,onSelect:function(e){for(var t=0;t<e.length;t++){var a=e[t],l=y(),n=w(a.url),r=i.createFileCardEle(l,a.url,n);i.files.push({id:l,type:n,name:a.name,url:a.url,status:" initial",file:null,$ele:r})}i.refreshPreviewFileList(),i.refreshValue()}})});var o=a.find(".jquery-uploader-select-card").not(".ml-browse-card");o.length?o.before(r):a.append(r)}}window.MediaLibrary=h,e(document).on("uploader-init","input",function(){var t=e(this);setTimeout(function(){var e=t.data("jqueryUploader");if(e&&!e._mlPatched){e._mlPatched=!0;var i=e.refreshPreviewFileList.bind(e);e.refreshPreviewFileList=function(){i(),k(e)},k(e)}},0)})}(jQuery);